<!doctype html>
<html lang="en">
<head>
    <link href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="css/screen.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <link href="css/print.css" media="print" rel="stylesheet" type="text/css" />
    <!--[if IE]>
        <link href="/stylesheets/ie.css" media="screen, projection" rel="stylesheet" type="text/css" />
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Analytics -->
<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "ur-ed89783-6fde-f735-c4a5-d1d23cc772e8", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>

</head>
<body>
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
              <a class="navbar-brand" href="#"><img src="http://www.crisistextline.org/logo.png" height="50" /> <span>Crisis Trends</span></a>
          </div>
          <div class="navbar-right">
              <span class='st_facebook_large' displayText='Facebook'></span>
              <span class='st_twitter_large' displayText='Tweet'></span>
              <span class='st_linkedin_large' displayText='LinkedIn'></span>
              <span class='st_email_large' displayText='Email'></span>
          </div>
      </div>
    </nav>


<div class="content" id="trends">
    <div class="container counter">
        <h1 id="counter">2,800,000</h1>
        <p class="lead">messages exchanged since August 1, 2013</p>
    </div>
    <div class="container">
        <ul class="nav nav-pills" role="tablist">
            <li class="active"><a href="#state" data-toggle="tab"><img src="images/us.svg" />Crises by State</a></li>
            <li><a href="#week" data-toggle="tab"><img src="images/month.svg" />Crises by Week</a></li>
            <li><a href="#time" data-toggle="tab"><img src="images/clock.svg" />Crises by Time of Day</a></li>
            <li><a href="#day" data-toggle="tab"><img src="images/week.svg" />Crises by Day of Week</a></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane active" id="state" data-url="images/state.png">
                <img src="images/state.png" style="height: auto" />
            </div>

            <div class="tab-pane" id="week" data-url="images/week.png">
                <img />
            </div>

            <div class="tab-pane" id="time" data-url="images/hour_of_day.png">
                <img />
            </div>

            <div class="tab-pane" id="day" data-url="images/day_of_week.png">
                <img />
            </div>
        </div>
    </div>

    <div class="container">
        <h1>Here's some action items...</h1>
        <p>Some content?</p>
    </div>

</div>

<!--------------------
 ------ scripts ------
 --------------------->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<script type="text/javascript" src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script type="text/javascript">
$('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
    $tabContent = $(e.target.getAttribute('href'));
    $tabContent.find('img')
        .attr('src', $tabContent.data('url'))
        .on('load', function () {
            $(this).css('height', 'auto');
        })
    ;
});

$('.smooth-scroll').click(function (e) {
    e.preventDefault();

    var $to = $($(this).attr('href'));
    $('html, body').animate({
        scrollTop: $to.offset().top
    });
});

var incrementer, baseCount;
$.getJSON('/counter/messages.json', function (data) {
    var timesMatrix = data['averages'];
    var countFrom = new Date(data['from']);
    var now = new Date();

    baseCount = data['baseCount'];

    var daysMatrix = {};
    for (var i in timesMatrix) {
        daysMatrix[i] = 0;
        for (var j in timesMatrix[i]) {
            daysMatrix[i] += timesMatrix[i][j];
        }
    }

    // increment by day first (faster)
    var start = countFrom.getTime();
    var interval = 24 * 60 * 60 * 1000;
    while ((start + interval) < now.getTime()) {
        start += interval;
        var day = new Date(start).getUTCDay() + 1;
        baseCount += daysMatrix[day];
    }
    countFrom = new Date(start);

    // now that we're up to today, increment by hour
    var hours = Math.floor((new Date().getTime() - countFrom.getTime()) / 1000 / 60 / 60);
    var today = now.getUTCDay() + 1;

    for (var i = i; i < now.getUTCHours(); i++) {
        baseCount += timesMatrix[today][i];
    }

    incrementer = timesMatrix[today][now.getUTCHours()] / (60 * 60);
});

function increment() {
    var d = new Date();
    var seconds = (d.getUTCMinutes() * 60) + d.getUTCSeconds();
    count = Math.round(baseCount + (seconds * incrementer));

    $('#counter').text(count.toLocaleString());
    return count;
}

setInterval(increment, 1000);

</script>
</body>
</html>
