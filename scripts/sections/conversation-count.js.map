{"version":3,"sources":["sections/conversation-count.js"],"names":["fail","incrementValue","config","conversations","fallbackConversationCount","intVal","parseInt","difference","currentVal","Math","ceil","updateDisplay","setTimeout","log","CONVERSATION_URL","conversationDiv","document","getElementById","innerHTML","toString","replace","window","getConversationCount","xhr","XMLHttpRequest","addEventListener","status","responseText","open","send"],"mappings":"AACA,cAEA,WAoCE,QAASA,KACPC,EAAeC,OAAOC,cAAcC,2BAQtC,QAASH,GAAeI,GACtBA,EAASC,SAASD,EAAQ,GAE1B,IAAME,GAAaF,EAASG,CAE5BA,IAAcC,KAAKC,KAAKH,EAAa,GAErCI,IAEIH,IAAeH,GACjBO,WAAW,WACTX,EAAeI,IACd,IAA6B,EAAvBI,KAAKI,IAAIN,IAxDtB,GAAMO,GAAmB,4EACnBC,EAAkBC,SAASC,eAAe,sBAK1CN,EAAgB,WAAA,MAEpBI,GAAgBG,UAAYV,EACzBW,WACAC,QAAQ,wBAAyB,MAElCZ,EAAaN,OAAOC,cAAcC,yBACtCO,KAEAU,OAAOC,qBAAuB,WAC5B,GAAMC,GAAM,GAAIC,eAEhBD,GAAIE,iBAAiB,OAAQ,WACR,MAAfF,EAAIG,OACNzB,EAAesB,EAAII,cAEnB3B,MAIJuB,EAAIE,iBAAiB,QAASzB,GAE9BuB,EAAIK,KAAK,MAAOd,GAChBS,EAAIM","file":"conversation-count.js","sourcesContent":["/* global config */\n'use strict';\n\n(() => {\n  const CONVERSATION_URL = 'https://4vammoq5j7.execute-api.us-east-1.amazonaws.com/prod/conversations';\n  const conversationDiv = document.getElementById('conversation-count');\n\n  /**\n   * Update the display to currentValue, formatted in 1,231,131,232 format\n   */\n  const updateDisplay = () =>\n    // format the string with commas every 3 places\n    conversationDiv.innerHTML = currentVal\n      .toString()\n      .replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',');\n\n  let currentVal = config.conversations.fallbackConversationCount;\n  updateDisplay();\n\n  window.getConversationCount = () => {\n    const xhr = new XMLHttpRequest();\n\n    xhr.addEventListener('load', () => {\n      if (xhr.status === 200) {\n        incrementValue(xhr.responseText);\n      } else {\n        fail();\n      }\n    });\n\n    xhr.addEventListener('error', fail);\n\n    xhr.open('GET', CONVERSATION_URL);\n    xhr.send();\n  };\n\n  /**\n   * Failure handler for a failed XHR request.\n   */\n  function fail() {\n    incrementValue(config.conversations.fallbackConversationCount);\n  }\n\n  /**\n   * Increment the current value by the difference from current to desired / 2.\n   *\n   * @param {integer} intVal Value we're shooting for\n   */\n  function incrementValue(intVal) {\n    intVal = parseInt(intVal, 10);\n\n    const difference = intVal - currentVal;\n\n    currentVal += Math.ceil(difference / 2);\n\n    updateDisplay();\n\n    if (currentVal !== intVal) {\n      setTimeout(() => {\n        incrementValue(intVal);\n      }, 125 - Math.log(difference) * 5);\n    }\n  }\n})();\n"]}