"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(){function t(t,n,e){for(var r,o,a,u=([{x:0,y:0},{x:s[0],y:s[1]}],n.x),i=n.y,l=Math.sqrt(s[0]*s[0]+s[1]*s[1]),c=w(s),h=Math.random()<.5?1:-1,x=-h;(r=c(x+=h))&&(o=~~r[0],a=~~r[1],!(Math.min(o,a)>l));)if(n.x=u+o,n.y=i+a,!(n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>s[0]||n.y+n.y1>s[1])&&(!e||!f(n,t,s[0]))&&(!e||y(n,e))){for(var d,g=n.sprite,v=n.width>>5,m=s[0]>>5,p=n.x-(v<<4),M=127&p,b=32-M,S=n.y1-n.y0,z=(n.y+n.y0)*m+(p>>5),I=0;I<S;I++){d=0;for(var k=0;k<=v;k++)t[z+k]|=d<<b|(k<v?(d=g[I*v+k])>>>M:0);z+=m}return delete n.sprite,!0}return!1}var s=[256,256],x=n,d=e,g=o,v=r,m=r,p=a,b=u,w=c,S=[],z=1/0,I=d3.dispatch("word","end"),k=null,T={};return T.start=function(){function n(){for(var n,y=+new Date;+new Date-y<z&&++a<o&&k;)n=f[a],n.x=s[0]*(Math.random()+.5)>>1,n.y=s[1]*(Math.random()+.5)>>1,i(n,f,a),n.hasText&&t(e,n,r)&&(u.push(n),I.word(n),r?l(r,n):r=[{x:n.x+n.x0,y:n.y+n.y0},{x:n.x+n.x1,y:n.y+n.y1}],n.x-=s[0]>>1,n.y-=s[1]>>1);a>=o&&(T.stop(),I.end(u,r))}var e=h((s[0]>>5)*s[1]),r=null,o=S.length,a=-1,u=[],f=S.map(function(t,n){return t.text=x.call(this,t,n),t.font=d.call(this,t,n),t.style=v.call(this,t,n),t.weight=m.call(this,t,n),t.rotate=p.call(this,t,n),t.size=~~g.call(this,t,n),t.padding=b.call(this,t,n),t}).sort(function(t,n){return n.size-t.size});return k&&clearInterval(k),k=setInterval(n,0),n(),T},T.stop=function(){return k&&(clearInterval(k),k=null),T},T.timeInterval=function(t){return arguments.length?(z=null==t?1/0:t,T):z},T.words=function(t){return arguments.length?(S=t,T):S},T.size=function(t){return arguments.length?(s=[+t[0],+t[1]],T):s},T.font=function(t){return arguments.length?(d=d3.functor(t),T):d},T.fontStyle=function(t){return arguments.length?(v=d3.functor(t),T):v},T.fontWeight=function(t){return arguments.length?(m=d3.functor(t),T):m},T.rotate=function(t){return arguments.length?(p=d3.functor(t),T):p},T.text=function(t){return arguments.length?(x=d3.functor(t),T):x},T.spiral=function(t){return arguments.length?(w=M[t+""]||t,T):w},T.fontSize=function(t){return arguments.length?(g=d3.functor(t),T):g},T.padding=function(t){return arguments.length?(b=d3.functor(t),T):b},d3.rebind(T,I,"on")}function n(t){return t.text}function e(){return"serif"}function r(){return"normal"}function o(t){return Math.sqrt(t.value)}function a(){return 30*(~~(6*Math.random())-3)}function u(){return 1}function i(t,n,e){if(!t.sprite){p.clearRect(0,0,(g<<5)/m,v/m);var r=0,o=0,a=0,u=n.length;for(--e;++e<u;){t=n[e],p.save(),p.font=t.style+" "+t.weight+" "+~~((t.size+1)/m)+"px "+t.font;var i=p.measureText(t.text+"m").width*m,f=t.size<<1;if(t.rotate){var l=Math.sin(t.rotate*d),y=Math.cos(t.rotate*d),c=i*y,s=i*l,h=f*y,x=f*l;i=Math.max(Math.abs(c+x),Math.abs(c-x))+31>>5<<5,f=~~Math.max(Math.abs(s+h),Math.abs(s-h))}else i=i+31>>5<<5;if(f>a&&(a=f),r+i>=g<<5&&(r=0,o+=a,a=0),o+f>=v)break;p.translate((r+(i>>1))/m,(o+(f>>1))/m),t.rotate&&p.rotate(t.rotate*d),p.fillText(t.text,0,0),t.padding&&(p.lineWidth=2*t.padding,p.strokeText(t.text,0,0)),p.restore(),t.width=i,t.height=f,t.xoff=r,t.yoff=o,t.x1=i>>1,t.y1=f>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,r+=i}for(var M=p.getImageData(0,0,(g<<5)/m,v/m).data,b=[];--e>=0;)if(t=n[e],t.hasText){for(var i=t.width,w=i>>5,f=t.y1-t.y0,S=0;S<f*w;S++)b[S]=0;if(r=t.xoff,null==r)return;o=t.yoff;for(var z=0,I=-1,k=0;k<f;k++){for(var S=0;S<i;S++){var T=w*k+(S>>5),q=M[(o+k)*(g<<5)+(r+S)<<2]?1<<31-S%32:0;b[T]|=q,z|=q}z?I=k:(t.y0++,f--,k--,o++)}t.y1=t.y0+I,t.sprite=b.slice(0,(t.y1-t.y0)*w)}}}function f(t,n,e){e>>=5;for(var r,o=t.sprite,a=t.width>>5,u=t.x-(a<<4),i=127&u,f=32-i,l=t.y1-t.y0,y=(t.y+t.y0)*e+(u>>5),c=0;c<l;c++){r=0;for(var s=0;s<=a;s++)if((r<<f|(s<a?(r=o[c*a+s])>>>i:0))&n[y+s])return!0;y+=e}return!1}function l(t,n){var e=t[0],r=t[1];n.x+n.x0<e.x&&(e.x=n.x+n.x0),n.y+n.y0<e.y&&(e.y=n.y+n.y0),n.x+n.x1>r.x&&(r.x=n.x+n.x1),n.y+n.y1>r.y&&(r.y=n.y+n.y1)}function y(t,n){return t.x+t.x1>n[0].x&&t.x+t.x0<n[1].x&&t.y+t.y1>n[0].y&&t.y+t.y0<n[1].y}function c(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function s(t){var n=4,e=n*t[0]/t[1],r=0,o=0;return function(t){var a=t<0?-1:1;switch(Math.sqrt(1+4*a*t)-a&3){case 0:r+=e;break;case 1:o+=n;break;case 2:r-=e;break;default:o-=n}return[r,o]}}function h(t){for(var n=[],e=-1;++e<t;)n[e]=0;return n}var x,d=Math.PI/180,g=64,v=2048,m=1;"undefined"!=typeof document?(x=document.createElement("canvas"),x.width=1,x.height=1,m=Math.sqrt(x.getContext("2d").getImageData(0,0,1,1).data.length>>2),x.width=(g<<5)/m,x.height=v/m):x=new Canvas(g<<5,v);var p=x.getContext("2d"),M={archimedean:c,rectangular:s};p.fillStyle=p.strokeStyle="red",p.textAlign="center","object"===("undefined"==typeof module?"undefined":_typeof(module))&&module.exports?module.exports=t:(d3.layout||(d3.layout={})).cloud=t}();
//# sourceMappingURL=d3.cloud.js.map
